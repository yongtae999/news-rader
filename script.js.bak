// --- 더미 데이터 영역 (실제 운영시에는 API 연동으로 대체) ---
const newsData = {
    hunting: [
        { id: 1, title: '환경부, \'꽃사슴\' 유해야생동물 지정 추진... 생태계 보호 목적', excerpt: '번식력이 강하고 천적이 없어 농작물 및 자생식물에 피해를 유발하는 꽃사슴이 유해야생동물로 지정될 전망입니다.', body: '최근 환경부는 농림수산업 피해 및 생태계 교란을 염려하여 \'꽃사슴\'을 유해야생동물로 지정하기 위한 야생생물 보호 및 관리에 관한 법률 시행령 개정안을 입법예고했습니다.<br><br>유해야생동물로 지정되면 지자체장의 허가를 받아 포획이 가능해져 개체수 조절이 용이해질 것으로 기대됩니다.', source: '환경부', image: 'images/env_gov.png', daysAgo: 0 },
        { id: 2, title: '야생동물 먹이주기 행위, 2026년부터 과태료 대상', excerpt: '2026년 1월부터 개정된 야생생물법에 따라 지자체별로 유해 야생동물 먹이주기를 제재할 수 있게 됩니다.', body: '환경부에 따르면 2026년부터 개정된 야생생물 보호 및 관리에 관한 법률이 본격 시행됨에 따라, 각 지방자치단체는 도심지나 농경지 주변에서 유해 야생동물(집비둘기 등)에게 먹이를 주는 행위를 원칙적으로 제한하거나 금지할 수 있습니다.<br><br>이를 지속적으로 위반해 주변 미관 및 생태계에 부정적 영향을 미칠 시, 최대 100만 원의 과태료가 부과됩니다.', source: '환경부', image: 'images/env_gov.png', daysAgo: 1 },
        { id: 3, title: '국내 생태계 보호를 위한 야생동물 영업허가제 본격 시행', excerpt: '동물을 전시하거나 가공·판매하는 관련 영업의 시설 기준과 준수사항이 강화된 야생동물 영업허가제가 도입됩니다.', body: '환경부는 감염병 예방 및 건전한 야생동물 취급 질서 확립을 위해 \'야생생물 보호 및 관리에 관한 법률\' 시행규칙을 개정하여 영업허가제를 시행합니다.<br><br>취급 규모와 영업장 시설 기준, 허용된 종(백색목록) 등을 철저히 관리하여 생태계 안전망을 촘촘히 짤 계획입니다.', source: '환경부', image: 'images/env_gov.png', daysAgo: 2 },
        { id: 4, title: '겨울철 야생동물 불법 밀렵 및 밀거래 집중 단속기간 운영', excerpt: '환경부와 경찰청 합동으로 동절기 불법 엽구 제작, 보관 행위에 대한 전국적인 특별 단속이 실시됩니다.', body: '환경부는 경찰청, 지자체 및 시민사회단체와 협력하여 매년 겨울철마다 반복되는 불법 엽구류 설치와 야생동물 밀거래 행위에 대해 집중 단속을 벌이고 있습니다.<br><br>적발될 경우 관련법령에 따라 엄중한 처벌을 받게 되며, 불법 포획된 야생동물을 취식하는 행위 역시 제재 대상에 포함됩니다.', source: '환경부/경찰청', image: 'images/police.png', daysAgo: 3 },
        { id: 5, title: '고라니·멧돼지 개체수 폭증에 따른 순환수렵장 운영 방안 논의', excerpt: '유해야생동물 억제와 지역 경제 활성화를 위한 순환수렵장이 일부 재개될 가능성이 검토되고 있습니다.', body: '매년 약 15만 마리 이상 포획되고 있는 고라니와 최근 도심 출몰이 잦은 야생 멧돼지의 개체수 조절 차원에서, 지역 단위 순환수렵장 운영이 대안으로 논의되고 있습니다.<br><br>다만 아프리카돼지열병(ASF) 확산 우려가 여전함에 따라, 방역과 포획이라는 두 마리 토끼를 어떻게 잡을지가 수렵인과 당국의 주요 과제로 떠올랐습니다.', source: '지자체', image: 'images/hunter.png', daysAgo: 5 },
        { id: 6, title: '야외 수렵 시 총기 안전 수칙 준수 재차 당부', excerpt: '경찰청과 야생생물관리협회는 민간 수렵인들을 대상으로 총기 보관 및 오발 사고 방지 지침을 발표했습니다.', body: '본격적인 포획 활동 시기를 맞아 야생생물관리협회와 관할 경찰청은 총기 사고 예방을 위한 철저한 출입고 통제 및 현장 안전 수칙 준수를 당부했습니다.<br><br>식별이 용이한 수렵 조끼 착용과 더불어 주류 섭취 금지, 주간 및 표적 완전 확인 후 격발 등 기본에 충실한 활동을 이어나갈 것을 강조했습니다.', source: '경찰청', image: 'images/police.png', daysAgo: 7 }
    ],
    asf: [
        { id: 7, title: '홍천·횡성 일대 야생멧돼지 ASF 다시 발생… 3년만의 재확산 우려', excerpt: '강원도 지역에서 3년 6개월 만에 아프리카돼지열병 폐사체가 잇따라 추가 발견되어 방역당국에 비상이 걸렸습니다.', body: '2026년 2월, 강원도 홍천, 횡성, 화천 지역을 중심으로 아프리카돼지열병(ASF)에 감염된 야생 멧돼지가 다수 발견되었습니다.<br><br>특히 홍천에서는 과거 발생 이후 약 3년 6개월 만의 재발이며, 겨울철 멧돼지들의 번식 활동과 맞물려 이동 범위가 넓어짐에 따라 바이러스 확산 우려가 팽배해진 상황입니다.', source: '국립야생동물질병관리원', image: 'images/boar.png', daysAgo: 0 },
        { id: 8, title: '경남 합천·의령 양돈농장 ASF 발생… 긴급 방역 조치 실시', excerpt: '남부 지방인 경상남도 일대 농장에서도 아프리카돼지열병 양성 판정이 나와 이동 중지 명령이 떨어졌습니다.', body: '이례적으로 올해 2월 들어 강원도뿐만 아니라 경남 합천과 의령 등 남부 내륙의 양돈농장에서도 ASF가 발생하였습니다.<br><br>이에 따라 농림축산식품부는 즉각적인 살처분 및 역학조사 조치를 시행하고, 전국적인 확산을 막기 위해 인근 도로 및 농장 출입구에 대한 집중 소독을 벌이고 있습니다.', source: '농림축산식품부', image: 'images/env_gov.png', daysAgo: 0 },
        { id: 9, title: '"산행 시 접촉 주의" ASF 확산 방지를 위한 입산객 안내', excerpt: '봄철 등산객 증가에 대비하여 야생 멧돼지 서식지 접근과 임산물 채취 자제를 요청하는 캠페인이 열립니다.', body: '환경부는 등산이나 나물 채취 목적으로 산에 오르는 국민들에게 ASF 바이러스 전파 매개 요소가 될 가능성이 있음을 경고했습니다.<br><br>감염된 멧돼지 폐사체를 발견할 시 즉시 신고하고, 해당 지역 방문 후에는 신발이나 차량 매트를 철저히 소독할 것을 권고하는 캠페인을 지자체 합동으로 전개 중입니다.', source: '환경부', image: 'images/hunter.png', daysAgo: 1 },
        { id: 10, title: '발견되는 바이러스 변이… 새로운 ASF 유전자형(IGR-I) 확인', excerpt: '기존 야생멧돼지에서 맴돌던 유전자형(IGR-II)과 다른 유형이 최근 확인되면서 추가 역학조사가 진행 중입니다.', body: '역학 조사자들에 따르면, 2019년 국내 최초 발생 이래 야생멧돼지에 널리 퍼져있던 바이러스 유형(IGR-II)과는 상이한 새로운 변이형(IGR-I)이 발견되었습니다.<br><br>당국은 해외 또는 전혀 다른 경로를 통한 유입 가능성을 배제하지 않고 정밀 조사를 진행하고 있습니다.', source: '농림축산식품부', image: 'images/env_gov.png', daysAgo: 2 },
        { id: 11, title: '국내 개발 ASF 생백신, 글로벌 상용화 박차', excerpt: '최근 분리된 한국 멧돼지 유래 ASF 백신 후보주를 바탕으로 독자적인 생백신 상용화가 추진되고 있습니다.', body: '국내 동물용 백신 전문기업 중앙백신연구소는 국립야생동물질병관리원이 야생 멧돼지에서 분리, 개발한 백신 후보주 기술을 이전받아 ASF 생백신 개발을 본격화했습니다.<br><br>그동안 전 세계적으로 안전성과 효능이 완벽히 입증된 상용 백신이 부재했던 만큼, 이번 프로젝트가 조속히 성공한다면 막대한 수출 실적과 방역 효과 상승을 달성할 것으로 기대됩니다.', source: '백신/의약업계', image: 'images/boar.png', daysAgo: 3 },
        { id: 12, title: '광역 울타리 재점검 및 멧돼지 기피제 살포 확대', excerpt: '정부는 멧돼지 남하를 막기 위해 기설치된 광역 울타리를 봄철 해빙기를 맞아 일제히 보수하기로 결정했습니다.', body: '한겨울 폭설과 야생동물들의 충돌로 인해 광역 울타리 일부 구간의 훼손이 확인됨에 따라, 관계 당국은 긴급 보수팀을 편성해 울타리를 정비하고 있습니다.<br><br>이와 더불어 농장 주변에는 멧돼지 접근을 막기 위한 기피제를 대대적으로 무상 배포 및 살포하여 농가 단위 점검망을 더욱 촘촘히 짤 방침입니다.', source: '환경부', image: 'images/env_gov.png', daysAgo: 6 }
    ],
    ecosystem: [
        { id: 13, title: '매년 수억 원 투입에도 끝없는 전쟁, 생태계교란생물', excerpt: '뉴트리아, 가시박 등으로 인한 생태계 및 경제적 피해 규모가 심각해 지자체들의 근심이 깊어지고 있습니다.', body: '외래 유입 이후 토착화되어 엄청난 번식력을 자랑하는 생태계교란생물이 전국적인 생태계 위협 요소로 꼽히고 있습니다.<br><br>환경부에 따르면 교란종 38종에 대한 제거 예산으로 매년 막대한 자금이 투입 중이나, 씨앗이나 유생의 강력한 확산력으로 인해 완전 박멸과 근원적인 퇴치가 결코 쉽지 않은 실정입니다.', source: '환경부', image: 'images/env_gov.png', daysAgo: 0 },
        { id: 14, title: '낙동강 유역의 \'괴물쥐\' 뉴트리아, 8년 새 개체수 급감', excerpt: '적극적인 포획 포상금 제도 운영 결과, 부산·경남 지역의 야생 뉴트리아 개체수가 2천 마리 수준으로 대폭 줄었습니다.', body: '과거 모피 및 식용 등의 목적으로 수입되었다가 야생에 버려져 낙동강 생태계를 생물부터 갈대 뿌리까지 무자비하게 파괴하던 뉴트리아가 크게 줄고 있습니다.<br><br>2014년 수만에 달했던 개체수는 낙동강유역환경청의 끈질긴 전담퇴치반 가동과 시민 수매 포상금 제도를 통해 2022년 말 기준 2천 마리 언저리로 억제되었으며 통제 가능한 범위 내에 접어들었다는 평가가 나옵니다.', source: '낙동강유역환경청', image: 'images/nutria.png', daysAgo: 1 },
        { id: 15, title: '수원청개구리의 천적 \'황소개구리\', 올무·포획망 총동원', excerpt: '환경부는 멸종위기인 토종 양서류 보호를 위해 습지보호지역 등 보전구역 내 황소개구리 성체 및 올챙이 제거 작업에 착수했습니다.', body: '멸종위기 야생생물 1급인 수원청개구리와 2급 금개구리를 마구 잡아먹어 생존을 위협하는 황소개구리에 대해 관계 당국이 칼을 빼 들었습니다.<br><br>특히 알에서 갓 깨어난 엄청난 양의 올챙이들이 성체가 되기 전인 3~4월, 보전가치가 높은 습지를 중심으로 대규모 그물망과 통발 등 모든 포획 수단을 동원해 서식처 환경수호에 박차를 가하고 있습니다.', source: '환경부', image: 'images/bullfrog.png', daysAgo: 2 },
        { id: 16, title: '농경지와 하천변을 삼키는 \'식물계의 황소개구리\' 가시박', excerpt: '주변 식물의 햇빛을 가려 결국 고사시키는 덩굴식물 가시박이 북상하며 지자체 곳곳에 비상이 걸렸습니다.', body: '북미 원산인 가시박은 줄기가 1년에 최대 25m까지 자라면서 단일 개체에서 7만 개가 넘는 씨앗을 생산해냅니다.<br><br>장마철 불어난 물을 타고 씨앗이 상류에서 떠내려가며 하천 수변목부터 농경지까지 넓은 잎으로 광합성을 완전히 차단해 숙주 식물을 궤멸시킵니다. 심지어 날카로운 가시를 지녀 농가의 제초 작업에도 큰 고통과 막대한 노동력이 수반되므로 생태계 교란의 끝판왕으로 지목됩니다.', source: '산림청', image: 'images/env_gov.png', daysAgo: 2 },
        { id: 17, title: '방생 문화로 인한 외래 거북 유입 주의 및 처벌 규정 안내', excerpt: '종교적 이유 등으로 붉은귀거북, 늑대거북과 같은 교란종을 하천에 풀어놓는 방생 행위는 명백한 불법으로 처벌 대상입니다.', body: '일부 행사장이나 개인이 기르다 무작정 버리는 대형 외래종 거북이류가 토종 물고기와 양서류, 심지어 작은 수조류와 수초까지 포식하며 하천 생태계의 붕괴를 초래하고 있습니다.<br><br>환경부는 붉은귀거북을 비롯해 악어거북 등 외래종의 자연계 방출은 생태계 보존 역행의 핵심이므로 엄격히 단속, 적발 시 최대 200만 원 상당의 법률에 따른 처벌과 과태료 처분에 처해짐을 경고하고 안내했습니다.', source: '환경부/지자체', image: 'images/bullfrog.png', daysAgo: 4 },
        { id: 18, title: '큰입배스 낚시대회 성황… 잡힌 교란어종은 비료로 활용', excerpt: '유해 어종의 포획을 장려하기 위해 치러진 대규모 낚시대회의 수확물들이 친환경 농업용 비료로 재탄생합니다.', body: '하천 생태계의 제왕으로 군림하며 토종 치어를 잡아먹는 외래 육식어종인 큰입배스와 블루길을 잡아들여 수상 생태계의 균형을 되찾으려는 낚시대회가 큰 호응 속에 마무리되었습니다.<br><br>지자체와 주최 측은 시민들의 스포츠 낚시 활동으로 모인 수십 킬로그램의 어획물을 인근 농가 및 친환경 비료 생산업체에 무상 제공, 액비나 펠릿형 퇴비 형태로 자원화시키며 포획과 활용의 1석 2조 긍정 사이클을 실현하고 있습니다.', source: '한국낚시협회', image: 'images/hunter.png', daysAgo: 5 }
    ]
};

// 날짜 포맷 함수 (YY.MM.DD)
function formatDate(date) {
    const year = date.getFullYear().toString().slice(2);
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}.${month}.${day}`;
}

// 상단 헤더 오늘 날짜 설정
function updateHeaderDate() {
    const today = new Date();
    const dateElement = document.getElementById('currentDate');
    const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'short' };
    const dateString = today.toLocaleDateString('ko-KR', options);

    dateElement.innerHTML = `<i class="fa-regular fa-calendar-check"></i> ${dateString}`;
}

// '몇 일 전'을 기반으로 최근 날짜를 계산해주는 함수 (매일 업데이트 시뮬레이션 용도)
function calculatePublishedDate(daysAgo) {
    const today = new Date();
    today.setDate(today.getDate() - daysAgo);
    return formatDate(today);
}

// 뉴스 카드 HTML 생성 함수
function createNewsCard(newsItem, index) {
    const imageUrl = newsItem.image;
    let categoryName = '';

    switch (currentCategory) {
        case 'hunting': categoryName = "수렵"; break;
        case 'asf': categoryName = "ASF 동향"; break;
        case 'ecosystem': categoryName = "교란생물"; break;
    }

    // 오늘 업데이트 된 기사면 'N시간 전' 또는 '오늘' 표시 로직 추가 가능하지만 현재는 날짜로 통일
    const publishedDate = calculatePublishedDate(newsItem.daysAgo);
    let isNew = newsItem.daysAgo === 0 ? '<span style="color:var(--accent-color); font-weight:bold; margin-right: 5px;">[새소식]</span>' : '';

    return `
        <a href="#" class="news-card" aria-label="${newsItem.title} 기사 읽기" onclick="openNewsModal(${newsItem.id}); return false;">
            <div class="card-image">
                <span class="card-category-badge">${categoryName}</span>
                <img src="${imageUrl}" alt="기사 섬네일 이미지" loading="lazy">
            </div>
            <div class="card-content">
                <div class="card-meta">
                    <span class="card-source"><i class="fa-regular fa-building"></i> ${newsItem.source}</span>
                    <span class="card-date"><i class="fa-regular fa-clock"></i> ${publishedDate}</span>
                </div>
                <h2 class="card-title">${isNew}${newsItem.title}</h2>
                <p class="card-excerpt">${newsItem.excerpt}</p>
                <div class="card-footer">
                    <span>자세히 보기</span>
                    <i class="fa-solid fa-arrow-right"></i>
                </div>
            </div>
        </a>
    `;
}

// 렌더링 관련 전역 변수
let currentCategory = 'hunting';
const newsListContainer = document.getElementById('newsList');
const loadingSpinner = document.getElementById('loadingSpinner');

// 뉴스 렌더링 로직
function renderNews(category) {
    // 이전 뉴스 페이드 아웃
    newsListContainer.classList.add('fade-out');
    loadingSpinner.classList.add('active');

    setTimeout(() => {
        const items = newsData[category];

        if (items && items.length > 0) {
            // 날짜 최신순 정렬 (daysAgo 기준 오름차순 - 0이 제일 최신)
            const sortedItems = [...items].sort((a, b) => a.daysAgo - b.daysAgo);

            const html = sortedItems.map((item, index) => createNewsCard(item, index)).join('');
            newsListContainer.innerHTML = html;
        } else {
            newsListContainer.innerHTML = `
                <div class="empty-state">
                    <i class="fa-regular fa-folder-open" style="font-size: 3rem; margin-bottom: 1rem; color: var(--text-secondary);"></i>
                    <p>현재 등록된 뉴스가 없습니다.</p>
                </div>
            `;
        }

        // 새로 렌더링된 요소 페이드 인
        loadingSpinner.classList.remove('active');
        newsListContainer.classList.remove('fade-out');
    }, 400); // 부드러운 전환을 위한 인위적 지연 (로딩 시뮬레이션)
}

// 탭 전환 핸들러
function initTabs() {
    const tabs = document.querySelectorAll('.tab-button');
    const indicator = document.querySelector('.tab-indicator');

    tabs.forEach((tab, index) => {
        tab.addEventListener('click', () => {
            // 이미 활성화된 탭이면 무시
            if (tab.classList.contains('active')) return;

            // 모든 탭 활성화 해제
            tabs.forEach(t => t.classList.remove('active'));

            // 클릭된 탭 활성화
            tab.classList.add('active');

            // 데스크탑 인디케이터 슬라이딩 애니메이션 계산 (탭 3개 기준)
            if (window.innerWidth > 768) {
                indicator.style.transform = `translateX(${index * 100}%)`;
            }

            // 데이터 변경 렌더링 호출
            currentCategory = tab.getAttribute('data-category');
            renderNews(currentCategory);
        });
    });

    // 리사이즈 시 인디케이터 초기화 (모바일 <-> 해상도 전환 대비)
    window.addEventListener('resize', () => {
        if (window.innerWidth <= 768) {
            indicator.style.transform = 'none';
        } else {
            const activeIndex = Array.from(tabs).findIndex(t => t.classList.contains('active'));
            if (activeIndex !== -1) {
                indicator.style.transform = `translateX(${activeIndex * 100}%)`;
            }
        }
    });
}

// 모달 동작 스크립트 추가
const modalOverlay = document.getElementById('newsModal');
const closeModalBtn = document.getElementById('closeModal');

function openNewsModal(newsId) {
    // 1. 해당 id의 기사 객체 찾기
    let targetNews = null;
    let targetCategoryName = '';

    // 이중 루프 대신 카테고리별로 순회하여 찾기
    for (const [key, items] of Object.entries(newsData)) {
        const found = items.find(item => item.id === newsId);
        if (found) {
            targetNews = found;
            if (key === 'hunting') targetCategoryName = '수렵';
            if (key === 'asf') targetCategoryName = 'ASF 동향';
            if (key === 'ecosystem') targetCategoryName = '교란생물';
            break;
        }
    }

    if (!targetNews) return;

    // 2. 모달 내 DOM 엘리먼트에 데이터 주입
    document.getElementById('modalCategory').textContent = targetCategoryName;
    document.getElementById('modalTitle').textContent = targetNews.title;
    document.getElementById('modalSource').innerHTML = `<i class="fa-regular fa-building"></i> ${targetNews.source}`;

    const publishedDate = calculatePublishedDate(targetNews.daysAgo);
    document.getElementById('modalDate').innerHTML = `<i class="fa-regular fa-clock"></i> ${publishedDate}`;

    document.getElementById('modalImage').src = targetNews.image;

    // 본문 내용 생성 (항목별 실제 저장된 상세 body 텍스트 활용)
    const articleBodyHTML = `
        <p><strong>${targetNews.excerpt}</strong></p>
        <p>${targetNews.body}</p>
    `;
    document.getElementById('modalBody').innerHTML = articleBodyHTML;

    // 3. 모달 열기 애니메이션 클래스 추가 및 배경 스크롤락
    modalOverlay.classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeNewsModal() {
    modalOverlay.classList.remove('active');
    document.body.style.overflow = '';
}

// 초기화
document.addEventListener('DOMContentLoaded', () => {
    updateHeaderDate();
    initTabs();

    // 초기 로딩 시 첫번재 카테고리 데이터 바인딩
    renderNews(currentCategory);

    // 모달 닫기 이벤트 리스너
    closeModalBtn.addEventListener('click', closeNewsModal);

    // 모달 외부(딤 처리된 배경) 클릭 시 닫기
    modalOverlay.addEventListener('click', (e) => {
        if (e.target === modalOverlay) {
            closeNewsModal();
        }
    });

    // ESC 키 입력 시 닫기
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modalOverlay.classList.contains('active')) {
            closeNewsModal();
        }
    });
});
